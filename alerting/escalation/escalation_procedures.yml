escalation_procedures:
  # Level 1: Immediate Response (0-15 minutes)
  level_1:
    name: "Critical/Immediate Response"
    trigger_conditions:
      - severity: critical
      - escalation_level: 1
      - business_impact: critical
      - revenue_impact: high
      - security_incident: true

    response_time_sla: "5 minutes"
    acknowledgment_required: true

    notification_channels:
      primary:
        - type: "pagerduty"
          endpoint: "https://events.pagerduty.com/integration/INTEGRATION_KEY/enqueue"
          urgency: "high"
        - type: "sms"
          recipients: ["oncall_primary", "oncall_secondary"]
        - type: "phone_call"
          recipients: ["oncall_primary"]
          delay_seconds: 300  # Call if not acknowledged in 5 minutes

      secondary:
        - type: "slack"
          channels: ["#alerts-critical", "#incident-response"]
          mention_groups: ["@oncall", "@sre-team"]
        - type: "email"
          recipients: ["oncall@ecap.local", "leadership@ecap.local"]
          priority: "high"

    automatic_actions:
      - action: "create_incident"
        severity: "sev1"
        incident_management_tool: "pagerduty"
      - action: "open_bridge"
        conference_bridge: "zoom"
        participants: ["oncall_primary", "oncall_secondary", "sre_lead"]
      - action: "notify_stakeholders"
        delay_minutes: 10
        recipients: ["cto@ecap.local", "product_lead@ecap.local"]

    escalation_timeline:
      - time: "5m"
        action: "escalate_to_oncall_secondary"
        condition: "not_acknowledged"
      - time: "10m"
        action: "escalate_to_sre_lead"
        condition: "not_resolved"
      - time: "15m"
        action: "escalate_to_engineering_manager"
        condition: "not_resolved"

    runbook_requirements:
      - immediate_triage_steps: "mandatory"
      - rollback_procedures: "documented"
      - status_page_update: "required"
      - customer_communication: "required_if_external_impact"

  # Level 2: High Priority (0-30 minutes)
  level_2:
    name: "High Priority Response"
    trigger_conditions:
      - severity: warning
      - escalation_level: 2
      - business_impact: medium
      - tier: business-critical

    response_time_sla: "15 minutes"
    acknowledgment_required: true

    notification_channels:
      primary:
        - type: "slack"
          channels: ["#alerts-warning", "#sre-oncall"]
          urgency: "high"
        - type: "email"
          recipients: ["oncall@ecap.local"]

      secondary:
        - type: "pagerduty"
          endpoint: "https://events.pagerduty.com/integration/INTEGRATION_KEY/enqueue"
          urgency: "low"
          delay_minutes: 20

    automatic_actions:
      - action: "create_ticket"
        ticket_system: "jira"
        priority: "high"
      - action: "gather_diagnostic_data"
        tools: ["prometheus_snapshot", "log_aggregation", "trace_collection"]

    escalation_timeline:
      - time: "15m"
        action: "escalate_to_senior_engineer"
        condition: "not_acknowledged"
      - time: "30m"
        action: "escalate_to_level_1"
        condition: "symptoms_worsening"

  # Level 3: Standard Priority (0-60 minutes)
  level_3:
    name: "Standard Priority Response"
    trigger_conditions:
      - escalation_level: 3
      - alert_type: predictive
      - tier: capacity-planning

    response_time_sla: "60 minutes"
    acknowledgment_required: false

    notification_channels:
      primary:
        - type: "slack"
          channels: ["#alerts-info", "#capacity-planning"]
        - type: "email"
          recipients: ["sre-team@ecap.local", "capacity-team@ecap.local"]

    automatic_actions:
      - action: "create_ticket"
        ticket_system: "jira"
        priority: "medium"
      - action: "schedule_investigation"
        timeline: "next_business_day"
      - action: "update_capacity_dashboard"

# Specialized Escalation Procedures
specialized_procedures:
  security_incidents:
    name: "Security Incident Response"
    trigger_conditions:
      - alert_type: security_incident
      - security_incident: true

    immediate_actions:
      - action: "isolate_affected_systems"
        automation: "ansible_playbook"
        playbook: "security_isolation.yml"
      - action: "preserve_evidence"
        tools: ["log_collection", "memory_dump", "network_capture"]
      - action: "notify_security_team"
        urgency: "immediate"

    notification_channels:
      - type: "secure_channel"
        endpoint: "security-team-encrypted@ecap.local"
      - type: "ciso_direct"
        phone: "CISO_PHONE_NUMBER"
      - type: "legal_notification"
        delay_minutes: 30
        condition: "data_breach_suspected"

    escalation_timeline:
      - time: "0m"
        action: "activate_security_team"
      - time: "30m"
        action: "notify_legal_team"
        condition: "potential_data_breach"
      - time: "60m"
        action: "external_incident_response"
        condition: "breach_confirmed"

  cascade_failures:
    name: "Cascade Failure Response"
    trigger_conditions:
      - alert_type: cascade_failure
      - tier: system-wide

    immediate_actions:
      - action: "enable_circuit_breakers"
        automation: "kubernetes_operator"
      - action: "scale_critical_services"
        automation: "auto_scaling"
        priority_services: ["api", "payments", "fraud-detection"]
      - action: "redirect_traffic"
        load_balancer: "aws_alb"
        fallback_regions: ["us-west-2", "eu-west-1"]

    coordination:
      - establish_command_center: true
      - incident_commander: "sre_lead"
      - communication_lead: "product_manager"
      - technical_lead: "principal_engineer"

  data_incidents:
    name: "Data Pipeline Incident Response"
    trigger_conditions:
      - service: data-pipeline
      - service: data-quality
      - tier: data-processing

    immediate_actions:
      - action: "pause_downstream_jobs"
        automation: "airflow_api"
      - action: "snapshot_current_state"
        tools: ["database_backup", "data_lake_snapshot"]
      - action: "validate_data_integrity"
        automation: "data_quality_checks"

    stakeholder_notification:
      - analytics_team: "immediate"
      - data_science_team: "immediate"
      - business_intelligence: "within_1h"
      - external_customers: "if_data_export_affected"

# On-Call Rotation Configuration
oncall_rotation:
  rotation_schedule:
    primary_oncall:
      - name: "Week 1"
        engineer: "alice@ecap.local"
        backup: "bob@ecap.local"
        start_date: "2025-01-27"
        timezone: "PST"

      - name: "Week 2"
        engineer: "bob@ecap.local"
        backup: "charlie@ecap.local"
        start_date: "2025-02-03"
        timezone: "PST"

      - name: "Week 3"
        engineer: "charlie@ecap.local"
        backup: "alice@ecap.local"
        start_date: "2025-02-10"
        timezone: "PST"

    secondary_oncall:
      rotation_type: "daily"
      team_members: ["senior_engineer_1", "senior_engineer_2", "senior_engineer_3"]
      override_capability: true

  escalation_matrix:
    business_hours:
      timezone: "PST"
      hours: "09:00-17:00"
      weekdays: ["monday", "tuesday", "wednesday", "thursday", "friday"]

      escalation_path:
        1. "primary_oncall"
        2. "secondary_oncall"
        3. "sre_lead"
        4. "engineering_manager"
        5. "cto"

    after_hours:
      escalation_path:
        1. "primary_oncall"
        2. "secondary_oncall"
        3. "sre_lead"
        4. "engineering_manager"

      escalation_delays:
        level_1: "5 minutes"
        level_2: "10 minutes"
        level_3: "15 minutes"
        level_4: "30 minutes"

  contact_methods:
    primary:
      - phone_call: "immediate"
      - sms: "immediate"
      - pagerduty: "immediate"

    secondary:
      - slack_dm: "within_1m"
      - email: "within_5m"

    backup:
      - emergency_phone: "if_primary_unreachable"
      - manager_escalation: "if_30m_no_response"

# Communication Templates
communication_templates:
  incident_declaration:
    subject: "ðŸš¨ SEV{{ severity }} INCIDENT: {{ alert_name }}"
    body: |
      INCIDENT DECLARED

      Severity: SEV{{ severity }}
      Service: {{ service }}
      Impact: {{ business_impact }}

      Summary: {{ summary }}

      Incident Commander: {{ incident_commander }}
      Status Page: {{ status_page_url }}
      Zoom Bridge: {{ zoom_url }}

      Updates will be provided every 15 minutes.

  status_page_update:
    investigating: |
      We are investigating reports of {{ issue_description }}.
      Our team is actively working on a resolution.
      Updates will be provided as more information becomes available.

    identified: |
      We have identified the issue affecting {{ affected_services }}.
      The root cause is {{ root_cause }}.
      A fix is being implemented and we expect resolution within {{ eta }}.

    resolved: |
      The issue affecting {{ affected_services }} has been resolved.
      All services are operating normally.
      We will continue to monitor the situation.

  customer_communication:
    email_template: |
      Dear Valued Customer,

      We experienced a service disruption that may have affected your experience
      between {{ start_time }} and {{ end_time }}.

      What happened: {{ incident_summary }}
      Impact: {{ customer_impact }}
      Resolution: {{ resolution_summary }}

      We sincerely apologize for any inconvenience this may have caused.

      If you have any questions or concerns, please contact our support team.

      The ECAP Team

# Automation Configuration
automation_config:
  auto_remediation:
    enabled_actions:
      - restart_unhealthy_containers
      - scale_up_on_high_load
      - clear_circuit_breakers
      - flush_problematic_caches
      - rotate_degraded_instances

    safety_limits:
      max_restarts_per_hour: 3
      max_scale_up_percentage: 200
      cooldown_period_minutes: 10
      require_manual_approval:
        - "database_operations"
        - "data_migration"
        - "security_changes"

  diagnostic_collection:
    automatic_triggers:
      - alert_severity: "critical"
      - escalation_level: 1
      - cascade_failure_detected: true

    collected_data:
      - prometheus_metrics: "last_1h"
      - application_logs: "last_30m"
      - system_metrics: "last_30m"
      - distributed_traces: "last_15m"
      - database_slow_queries: "last_30m"

    storage_location: "s3://ecap-incident-data"
    retention_days: 90

# Metrics and Reporting
escalation_metrics:
  kpis:
    - name: "mean_time_to_acknowledge"
      target: "< 5 minutes"
      measurement: "time_from_alert_to_ack"

    - name: "mean_time_to_resolution"
      target: "< 30 minutes"
      measurement: "time_from_alert_to_resolution"

    - name: "escalation_rate"
      target: "< 10%"
      measurement: "alerts_escalated / total_alerts"

    - name: "false_positive_rate"
      target: "< 5%"
      measurement: "false_alerts / total_alerts"

  reporting:
    weekly_report:
      recipients: ["sre-team@ecap.local", "engineering-leads@ecap.local"]
      metrics: ["incident_count", "mttr", "mtta", "escalation_rates"]

    monthly_review:
      recipients: ["engineering-manager@ecap.local", "cto@ecap.local"]
      deep_dive: true
      include_trends: true
      action_items: true
